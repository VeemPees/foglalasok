<!-- list page -->
<div align="center" data-role="page" id="item-list-page">
    <div data-role="header" data-theme="b">
         <h1>Szolgáltatások</h1>
    </div>
	<div role="main" class="ui-content">
		<div id="loader">
        </div>
		<ul data-role="listview" id="item-list" data-divider-theme="a" data-inset="true">
			<li data-role="list-divider" data-theme="b" role="heading">Nevek</li>
		</ul>
		<input type="button" onclick="buildItemTable()" value="Go" />
	</div>
</div>

<script>
function buildItemTable()
{
	startProgress();
    
    //var url = script_url + "?action=fetch";
    
	//$.getJSON(url, function (json) {
	//	  displayItems(json);
	//});
    
	google.script.run
		.withSuccessHandler(function(json) {
			displayItems(json);
		})
		.withFailureHandler(onFailure)
		.fetchItems();
}

function displayItems(json)
{
	$("#item-list").css("visibility", "visible");
    
    //set up string for adding <li/>
    var li = "";
    //container for $li to be added
    $.each(json.Items, function (i, item) {
        //add the <li> to "li" variable
        //note the use of += in the variable
        //meaning I'm adding to the existing data. not replacing it.
        //store index value in array as id of the <a> tag
        li += '<li><a href="#" id="' + i + '" class="info-go">' + item.name + '</a></li>';
    });
    //append list to ul
    $("#item-list").append(li).promise().done(function () {
        //wait for append to finish - thats why you use a promise()
        //done() will run after append is done
        //add the click event for the redirection to happen to #details-page
        $(this).on("click", ".info-go", function (e) {
            e.preventDefault();
            //store the information in the next page's data
            $("#details-page").data("item", json.Items[this.id]);
            //change the page # to second page. 
            //Now the URL in the address bar will read index.html#details-page
            //where #details-page is the "id" of the second page
            //we're gonna redirect to that now using changePage() method
            $.mobile.changePage("#details-page");
        });

        //refresh list to enhance its styling.
        $(this).listview("refresh");
    });
    
    endProgress();
}
</script>
